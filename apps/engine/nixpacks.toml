# =============================================================================
# NIXPACKS CONFIGURATION FOR RAILWAY DEPLOYMENT
# =============================================================================
# This file tells Railway/Nixpacks how to build and run the Python backend
# =============================================================================

# Use Python 3.11 and include ffmpeg for audio processing
[phases.setup]
nixPkgs = ["python311", "ffmpeg"]

# Install Python dependencies from apps/engine/requirements.txt
[phases.install]
cmds = ["pip install -r apps/engine/requirements.txt"]

# Start the FastAPI server
# PYTHONPATH is set to apps/engine so relative imports like ..pipelines work
[start]
cmd = "cd apps/engine && PYTHONPATH=. uvicorn api.main:app --host 0.0.0.0 --port ${PORT:-8000}"

[variables]
PYTHON_VERSION = "3.11"
PYTHONPATH = "apps/engine"
